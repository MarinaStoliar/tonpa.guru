<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="Maxim Sokhatsky" />
    <title>2018-10-22</title>
    <link rel="stylesheet" href="https://n2o.dev/blank.css" />
    <link rel="stylesheet" href="../../journal.css" />
</head>
<body>
<nav>
    <a href='../../index.html'>5HT</a>
    <a href='../index.html'>TOP</a>
    <a href='#'>2018-10-22</a>
</nav>
<main>
    <section>
        <h3>Новый ролаут N2O</h3>
        <p>
Всё хотел вести блог прямо в гитхабе и вот я здесь. Привет Твиттер!
        </p><p>
Раз в год я выкатываю свежие версии N2O. В этом году это — Более матурная MQTT библиотека,
которая вместе с веб-сокетной версией получили тег 5.10, последняя все ещё остается в отдельном репозитории;
NITRO уже смержилась и совместима с обеими версиями, кто знает, возможно, в следующих версиях,
или уже в новом, гду придёт гранд мерж MQTT и N2O репозиториев (осталось пару файлов
перенести из старого репозитория и запустить старый вебсокетный-пример на новом дереве)!
В связи с нарастающим количеством деприкейтов в логах, было принято решение залочить все чужие либы
и сделать что-то типа SYNRC хранилища репозиториев. В этом месяце в него вошли и залочились:
        </p><p>
— <a href="https://github.com/voxoz/cowboy">https://github.com/voxoz/cowboy</a> — 1.0.4<br>
— <a href="https://github.com/voxoz/cowlib">https://github.com/voxoz/cowlib</a> — 1.0.0<br>
— <a href="https://github.com/voxoz/ranch">https://github.com/voxoz/ranch</a> — 1.0.0<br>
— <a href="https://github.com/voxoz/erlydtl">https://github.com/voxoz/erlydtl</a> — 0.8<br>
— <a href="https://github.com/voxoz/emqttc">https://github.com/voxoz/emqttc</a> — 0.8<br>
— <a href="https://github.com/voxoz/gen_logger">https://github.com/voxoz/gen_logger</a> — 1.2<br>
— <a href="https://github.com/voxoz/lager">https://github.com/voxoz/lager</a> — 3.2.2<br>
— <a href="https://github.com/synrc/emq_dashboard">https://github.com/synrc/emq_dashboard</a> — 2.1.1<br>
— <a href="https://github.com/synrc/emqttd">https://github.com/synrc/emqttd</a> — 2.1.2<br>
— <a href="https://github.com/voxoz/esockd">https://github.com/voxoz/esockd</a> — 4.1.1<br>
— <a href="https://github.com/voxoz/mochiweb">https://github.com/voxoz/mochiweb</a> — 4.2.1<br>
— <a href="https://github.com/voxoz/gproc">https://github.com/voxoz/gproc</a> — 0.8<br>
— <a href="https://github.com/voxoz/syn">https://github.com/voxoz/syn</a> — 1.5<br>
        </p><p>
Одновременно с этим обновился главный хедлайнер сезона, библиотека voxoz/mq,
которая включает старый EMQ 2.1.2 и его дашборд. Кроме этого выкатилась октябрская волна
экосистемы N2O, а именно (от старых к новым):
        </p><p>
— <a href="https://github.com/synrc/n2o">https://github.com/synrc/n2o</a> — 5.10<br>
— <a href="https://github.com/synrc/kvs">https://github.com/synrc/kvs</a> — 5.10<br>
— <a href="https://github.com/synrc/mad">https://github.com/synrc/mad</a> — 4.10<br>
— <a href="https://github.com/synrc/fs">https://github.com/synrc/fs</a> — 4.10<br>
— <a href="https://github.com/synrc/active">https://github.com/synrc/active</a> — 4.10<br>
— <a href="https://github.com/synrc/nitro">https://github.com/synrc/nitro</a> — 3.10<br>
— <a href="https://github.com/synrc/bpe">https://github.com/synrc/bpe</a> — 3.10<br>
— <a href="https://github.com/synrc/sh">https://github.com/synrc/sh</a> — 2.10<br>
— <a href="https://github.com/synrc/review">https://github.com/synrc/review</a> — 1.10<br>
— <a href="https://github.com/synrc/bert">https://github.com/synrc/bert</a> — 1.10<br>
— <a href="https://github.com/synrc/mqtt">https://github.com/synrc/mqtt</a> — 5.10 (N2O-MQTT)<br>
        </p><p>
Вполне возможно, что пора, в стиле NIH-синдрома, писать протокол
своего репозитория пакетов вместе с бинарной дистрибюцией пакетови
самого эрланга (давно просят). Ведь даже я до таких глубин еще не
опускался, если npm-овцы могут, а я чем хуже!
        </p><p>
Где-то минорные фиксы, где-то ворнинги, все репозитории включены
в тревисе и можно видеить их стрим: https://travis-ci.org/voxoz,
https://travis-ci.org/synrc, там же можно глянуть все логи всех билдов.
Как видно многие репозитории не включены, поэтому в ближайших планах
засветить всё зеленым, это подзразумевает сборку ребаром и мёдом.
        </p><p>
Почему ругают mad, я не знаю, например на тревисе rebar на 19.3 gen_logger
        </p>
        <figure><code>
 ==> gen_logger (compile)
 ERROR: OTP release 20.0.4 or later is required, you have: 19
 ERROR: compile failed while processing
        /home/travis/build/synrc/review/deps/gen_logger: rebar_abort
        </code></figure>
        <p>
The command "rebar get-deps compile" exited with 1.
        </p><p>
не собирает, а с mad всё работает:
        </p>
        <figure><code>
 $ cat .travis.yml
 language: erlang
 otp_release:
   - 19.3
 script:
   - "curl -fsSL https://raw.github.com/synrc/mad/master/mad > mad"
   - "chmod +x mad"
   - "./mad dep com"
        </code></figure>
        <figure><code>
 The command "./mad dep com" exited with 0.
 Done. Your build exited with 0.
        </code></figure>
        <p>
mad начал поддерживать сборку кубическим тайпчекером, появился модуль mad_cubical,
но через год-два, кто знает, возможно тут будет уже свой AST трансформатор на Erlang.
        </p><p>
Всего эта работа заняла 170 коммитов в 30 репозиториев и ровно 1 сутки без перерыва.
Сюда входят все багфигсы и удаление файлов и склейка некоторых репозиториев,
всё, начиная от импорта, заканчивая ченджлогами и релизами. Я заморочился, но
добился что в билдлогах на 19.1, 19.2, 19.3, 20.0.4, 21.0.4, 21.1.1 нет ни одного ворнинга!
Думал, вообще по-чесному переписать esockd с gen_fsm на gen_statem но оказалось,
что задача одним днем не ограничится, поэтому 
        </p>
        <figure><code>
 {erl_opts,[nowarn_deprecated_function]}.
        </code></figure>
        <p>
спасла ситуацию. Но депрекейтеды валятся в оснвном на последних эрлангах, предлагают
как пошаговый турториал что на что переписывть, я прошел этот квест для esockd,
немного но запустить успешно с первого раза не удалось, а это ведь гланая часть тракта,
а если лики? поэтому я не стал.
        </p><p>
Планирую еще сделать много хорошего! Думаю занятся дизайном N2O,
возможно на кубике протоколы N2O пока нанпишу.
        </p><p>
Максим
        </p>
    </section>
</main>
<footer>Namdak Tonpa <span class="heart">&nbsp;❤&nbsp;</span> 2009—2019</footer>
</body>
</html>
